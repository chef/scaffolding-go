steps:
  - label: "Syntax"
    command:
      - apt-get update
      - apt-get install -y shellcheck
      - find . -name '*.sh' -print0 | xargs -0 -n1 shellcheck -e SC2034,SC2154 -s bash
    plugins:
      docker#v1.1.1:
        image: ubuntu:16.04
        workdir: /scaffolding-go
  - label: "Build & Test"
    command:
      - aws-configure chef-cd
      - AWS_PROFILE=chef-cd hab-origin download-sig-key "\$HAB_ORIGIN"
      - hab studio -D \$STUDIO_OPTS run "source .studiorc && build_and_test"
    env:
      HAB_ORIGIN: chef
      HAB_STUDIO_SUP: false
    agents:
      queue: 'docker-privileged'
    timeout_in_minutes: 10
    retry:
      automatic:
        limit: 3
